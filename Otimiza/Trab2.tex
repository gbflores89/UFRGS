
\section {Otimização sem restrições}
 
\subsection{Exercício 6.48 \cite{edgar2001optimization}}
\boxexercise{6.48}
{The cost of refined oil when shipped via the Malacca Straits to Japan in
dollars per kiloliter was given (Uchiyama, 1968) as the linear sum of the crude
oil cost, the insurance, customs, freight cost for the oil, loading and
unloading cost, sea berth cost, submarine pipe cost, storage cost, tank area
cost, refining cost, and freight cost of products as:   
\begin{equation}
\label{eq:ehl648}
\begin{aligned}
c = c_c &+ c_i + c_x + \frac{2.09\times 10^{4} t^{-0.3017}}{360} + \frac{1.064
\times 10^{6} at^{0.4925}}{52.47q\left(360\right)} \\
&+ \frac{4.242 \times 10^{4} at^{0.7952} + 1.813 ip \left(nt + 1.2q
\right)^{0.861}}{52.47q\left(360\right)}\\
&+ \frac{4.25 \times 10^{3} a\left(nt+1.2q\right) }{52.47q\left(360\right)}
+ \frac{5.042 \times 10^{3} q^{-0.1899}}{360}\\
&+ \frac{0.1049q^{0.671}}{360}
\end{aligned}
\end{equation}
were: 
\begin{conditions}
a	& annual fixed charges	& {fraction}	&($0.20$) \\
c_c	& crude oil price		&{\$/kL}		&($12.50$)\\
c_i	& insurance cost		&{\$/kL}		&($0.50$)\\
c_x	& customs cost			&{\$/kL}		&($0.90$)\\
i	& interest rate			&				&($0.10$)\\
n	& number of ports		&				&($2$)\\ 
p	& land price			&{\$/m$^2$}		&($7000$)\\
q	& refinery capacity		&{bbl/day}		&\\
t	& tanker size			&{kL} 			&\\
\end{conditions}
Given the values indicated in parentheses, use a computer code to compute the
minimum cost of oil and the optimum tanker size $t$ and refinery size $q$ by
Newton's method and the quasi-Newton method (note that $1~\text{kL} = 6.29
~\text{bbl}$).

The answers in the reference were:
\begin{conditions}
t & $427000$ dwt $\approx$ $485000$ kL \\
q & $185000$ bbl/day
\end{conditions}
}

Substituindo os valores de $a$, $c_c$, $c_i$, $c_x$, $i$, $n$ e $p$ na
\autoref{eq:ehl648} temos:
\begin{equation}
\begin{aligned}
c = 13.9 & + \cfrac{58.055}{{t}^{0.3017}}
+{\cfrac {11.266{t}^{ 0.4925}}{q}}\\
&+{\cfrac {5.294\times10^{-5}\left( 8484{t}^{
0.7952}
+1268.4\left( 2t+ 1.2q \right) ^{ 0.861}\right)}{q}}\\
&+\cfrac{0.630}{{q}^{1.1899}}
+2.914\times10^{-4}{q}^{ 0.671}
\end{aligned}
\end{equation}
onde o gradiente e hessiana de $c$ são dados por:
\begin{equation}
\renewcommand{\arraystretch}{2.5}
\nabla c = \left[
\begin{array}{c}
\cfrac{\partial c}{\partial t}\\
\cfrac{\partial c}{\partial q}\\
\end{array}
\right]
\quad \text{e}\quad
\nabla^2 c = \left[
\begin{array}{cc}
\cfrac{\partial^2 c}{\partial t^2}
& \cfrac{\partial^2 c}{\partial t \partial q}\\
\cfrac{\partial^2 c}{\partial q \partial t}
& \cfrac{\partial^2 c}{\partial q^2}
\end{array}
\right]
\end{equation}

As equações necessárias para $\nabla c$ e $\nabla^2c$ são dadas por:
\begin{align}
&\begin{aligned}
\cfrac{\partial c}{\partial t}= &- \cfrac{17.515}{{t}^{1.3017}}
+ {\cfrac {5.548}{t^{0.5075}q}}\\
&+ {\cfrac {5.294\times10^{-5} \left(\cfrac{6746.476}{{t}^{0.2048}}
+ \cfrac{2184.185}{\left( 2t+ 1.2q \right) ^{0.139}} \right)}{q}}
\end{aligned}\\
&\begin{aligned}
\cfrac{\partial c}{\partial q}=
& - {\cfrac {11.266{t}^{ 0.4925}}{{q}^{2}}}+ {\cfrac {0.0694 }{\left(
 2t+ 1.2q \right) ^{0.139}q}}\\
&- {\cfrac {5.294\times10^{-5} \left(8484.0{t}^{ 0.7952}
+ 1268.4 \left( 2\,t+ 1.2\,q \right) ^{ 0.861}\right)}{{q}^{2}}}\\
&-\cfrac{0.750}{{q}^{2.1899}} + \cfrac{1.955\times10^{-4}}{{q}^{0.329}}
\end{aligned}\\
&\begin{aligned}
\cfrac{\partial^2 c}{\partial t^2}=& \cfrac{22.800}{{t}^{2.3017}} -
{\cfrac {2.816}{{t}^{1.5075}q}}\\
&+  \cfrac {5.294\times10^{-5} \left( -\cfrac{1381.678}{{t}^{1.2048}}
- \cfrac{607.203}{ \left( 2\,t+ 1.2\,q \right) ^{1.139}}\right) }{q}
\end{aligned}\\
&\begin{aligned}
\cfrac{\partial^2 c}{\partial t \partial q}=& \cfrac{\partial^2 c}{\partial q
\partial t}= {\cfrac {5.548}{{t}^{0.5075}{q}^{2}}} - {\cfrac {0.01929 }{\left(2t+ 1.2q\right)
^{1.139}q}} \\
&- {\cfrac {5.294\times10^{-5} \left(\cfrac{6746.476}{{t}^{0.2048}}
+ \cfrac{2184.184}{\left( 2t+ 1.2q \right) ^{0.139}} \right)}{{q}^{2}}}
\end{aligned}\\
&\begin{aligned}
\cfrac{\partial^2 c}{\partial q^2}=
& {\cfrac {22.531{t}^{ 0.4925}}{{q}^{3}}} - {\cfrac {0.01157}{\left(
2t+ 1.2q \right) ^{1.139}q}} - {\cfrac {0.1387 }{\left( 2t+ 1.2q
\right) ^{0.139}{q}^{2}}}\\
&+ \cfrac {{1.059\times10^{-4}} \left(8484.0{t}^{ 0.7952} +
1268.4\left(2t+1.2q\right)^{0.861} \right)}{{q}^{3}} \\
&+ \cfrac{1.642}{{q}^{3.1899}} -
\cfrac{6.433\times10^{-5}}{{q}^{1.329}}
\end{aligned}
\end{align} 
 
Para a execução dos problemas, os Códigos \ref{code:ehl648c1},
\ref{code:ehl648c2} e \ref{code:ehl648c3} foram implemantados em Matlab da
seguinte maneira:
\lstinputlisting[caption={Problema proposto},
label={code:ehl648c1}]{trab2/EHL-6-48/ObjFunc.m} 

\lstinputlisting[caption={Gradiente do problema proposto},
label={code:ehl648c2}]{trab2/EHL-6-48/ObjFuncGrad.m} 

\clearpage
\lstinputlisting[caption={Hessiana do problema proposto},
label={code:ehl648c3}]{trab2/EHL-6-48/ObjFuncHessian.m} 
sendo que:
\begin{conditions}
x(1) & $t$\\
x(2) & $q$
\end{conditions}

\subsubsection{Newton}
Os resultados para o método de Newton foram obtidos com o
\autoref{code:ehl648script1} \lstinputlisting[language=Matlab, caption={Script
de execução para a resolução do problema utilizando o método de Newton},
label={code:ehl648script1}]{trab2/EHL-6-48/Script1.m}

Os resultados para cada interação:
\VerbatimInput[firstline=2, lastline=21]{trab2/EHL-6-48/Resultado1.txt}

Ponto de mínimo encontrado e função avaliada no ponto ótimo:
\begin{equation}
\renewcommand{\arraystretch}{1.2}
x^* = \left[
\begin{array}{c}
502050\\
80850\\ 
\end{array}
\right]
\quad \text{e}\quad
c(x^*)=15.9900
\end{equation}
\VerbatimInput[firstline=29, lastline=38]{trab2/EHL-6-48/Resultado1.txt}
\clearpage

\emph{Output} final do Matlab, confirmando que foi utilizado o método de Newton
\VerbatimInput[firstline=46,
lastline=53]{trab2/EHL-6-48/Resultado1.txt}\bigbreak


Valores de $\nabla c$ (\code{grad}), $\nabla^2 c$ (\code{hessian}) e
$\lambda(\nabla^2 c)$ (\code{eigHessian}) , confirmando que se trata de um
ponto de mínimo.
\VerbatimInput[firstline=56, lastline=79]{trab2/EHL-6-48/Resultado1.txt}

\clearpage
\subsubsection{quasi-Newton}
Os resultados para um método quasi-Newton foram obtidos com o
\autoref{code:ehl648script2} \lstinputlisting[language=Matlab, caption={Script
de execução para a resolução do problema utilizando um método quasi-Newton},
label={code:ehl648script2}]{trab2/EHL-6-48/Script2.m}

Os resultados para cada interação:
\VerbatimInput[firstline=5, lastline=10]{trab2/EHL-6-48/Resultado2.txt}

Ponto de mínimo encontrado e função avaliada no ponto ótimo:
\begin{equation}
\renewcommand{\arraystretch}{1.2}
x^* = \left[
\begin{array}{c}
500350\\
89660\\ 
\end{array}
\right]
\quad \text{e}\quad
c(x^*)=15.9921
\end{equation}
\VerbatimInput[firstline=20, lastline=29]{trab2/EHL-6-48/Resultado2.txt}

\clearpage
\emph{Output} final do Matlab, confirmando que foi utilizado um método
quasi-Newton
\VerbatimInput[firstline=37,
lastline=44]{trab2/EHL-6-48/Resultado2.txt}\bigbreak


Valores de $\nabla c$ (\code{grad}), $\nabla^2 c$ (\code{hessian}) e
$\lambda(\nabla^2 c)$ (\code{eigHessian}) , confirmando que se trata de um
ponto de mínimo.
\VerbatimInput[firstline=47, lastline=68]{trab2/EHL-6-48/Resultado2.txt}
% \VerbatimInput[numbers=left]{trab2/EHL-6-48/Resultado2.txt}

\subsubsection{Conlusão do Exercício 6.48}
Para o problema proposto, o método quasi-Newton apresentou melhor resultado, uma
vez que foi necessário um menor número de passos para chegar em $x^*$. Além do
mais, o método quasi-Newton não necessita do gradiente fa função objetivo.

\clearpage
\subsection{Exercício 6.44 \cite{edgar2001optimization}}
\boxexercise{6.44 (EHL, \citeyear{edgar2001optimization})}{
In a decision problem it is desired to minimize the
expected risk defined as follows: 
\begin{equation}
\label{eq:ehl644}
\varepsilon \{\text{risk} \} = \left(1-P\right)c_1\left[1-F(b) \right] + P c_2
\theta
\left(\frac{b}{2}+\frac{2\pi}{4}\right)F\left(\frac{b}{2}-\frac{\sqrt{2\pi}}{4}\right)
\end{equation}
were: 
\begin{conditions}
F(b) & $\displaystyle\int_{-\infty}^b e^{-u^2 / 2\theta^2} \diff u$ (normal
probability function)\\
c_1 & $1.25\times10^{5}$\\
c_2& $15$\\
\theta & $2000$\\
P &$0.25$
\end{conditions}

Find the minimum expected risk and $b$.  
}

Antes da substituição dos valores de $F(b)$, $c_1$, $c_2$, $\theta$ e $P$ na
\autoref{eq:ehl644} devemos encontar uma melhor representação para $F(b)$.
\begin{equation}
\label{eq:ehl644f}
F(b) = \int_{-\infty}^b \exp{\left(-\frac{u^2}{2\theta^2}\right)} \diff u
\end{equation}
integrando e aplicando os limites na \autoref{eq:ehl644f} temos:
\begin{equation}
\label{eq:ehl644f2}
F(b) = \sqrt{\dfrac{\pi}{2}} \left(\theta
\erf\left(\dfrac{b}{\theta\sqrt{2}}\right)
+\frac{1}{\sqrt{\dfrac{1}{\theta^2}}}
\right)
\end{equation}
onde a função $\erf$ é tabelada e dada por \cite{Maple10,Matlab2016}:
\begin{equation}
\erf\left(x\right) = \frac{2}{\sqrt{\pi}}\int_0^x \exp{\left(-t^2\right)}\diff t
\end{equation}

Assim, é facilmente obtida a expressão de $\varepsilon\{risk\}$, como
segue:
\newcommand{\auxalpha}{\left(\alpha_{\rm{aux}}\right)}
\newcommand{\auxbeta}{\left(\beta_{\rm{aux}}\right)}
\newcommand{\auxgamma}{\left(\gamma_{\rm{aux}}\right)}
\newcommand{\auxdelta}{\left(\delta_{\rm{aux}}\right)}
\begin{equation}
\label{eq:ehl644-2}
\varepsilon\{risk\} = \left[93750 -
46875 \auxalpha\right]
+3750\auxalpha\auxbeta\auxgamma
\end{equation}
onde $\auxalpha$, $\auxbeta$ e $\auxgamma$ são variaveis auxiliares dadas por:
\begin{align}
\auxalpha &= \sqrt{2\pi}\left(2000\erf\left(\frac{b\sqrt{2}}{4000}
\right)+\sqrt{4\times10^6}\right)\\
\auxbeta &= \left(\frac{b+\pi}{2}\right)\\
\auxgamma &= \left(\frac{2b+\sqrt{2\pi}}{4} \right)
\end{align}

A partir da \autoref{eq:ehl644-2} podemos obter os valores de
$\nabla\varepsilon\{risk\}$ e $\nabla^2\varepsilon\{risk\}$ como seguem:
\begin{align}
&\begin{aligned}
\cfrac{\partial \varepsilon\{risk\}}{\partial b}= &
-93750 \exp\auxdelta 
+ 1875 \auxalpha \auxgamma\\
&+7500\auxbeta \auxgamma \exp\auxdelta\\
&+1875\auxalpha\auxbeta
\end{aligned}\\
&\begin{aligned}
\cfrac{\partial^2 \varepsilon\{risk\}}{\partial b^2}=&
0.0234375 b \exp\auxdelta \\
&+7500\auxgamma\exp\auxdelta
+1875\auxalpha \\
&- 0.001875\auxbeta\auxgamma 
b \exp\auxdelta
\end{aligned}
\end{align} 
onde $\auxdelta$ também é uma variável auxiliar dada por:
\begin{equation}
\auxdelta = {\left(-\frac{b^2}{8\times10^6}\right)}
\end{equation}

Para a execução do Exercício 6.44, os Códigos \ref{code:ehl644c1},
\ref{code:ehl644c2} e \ref{code:ehl644c3} foram implemantados em Matlab da
seguinte maneira:
\lstinputlisting[caption={Problema proposto},
label={code:ehl644c1}]{trab2/EHL-6-44/ObjFunc.m} 

\clearpage
\lstinputlisting[caption={Gradiente do problema proposto},
label={code:ehl644c2}]{trab2/EHL-6-44/ObjFuncGrad.m} 
\lstinputlisting[caption={Hessiana do problema proposto},
label={code:ehl644c3}]{trab2/EHL-6-44/ObjFuncHessian.m} 
sendo que:
\begin{conditions}
x & $b$
\end{conditions}
\begin{figure}[H]
\center
\begin{tikzpicture}
\begin{axis}[
		xlabel = $b$,
        ylabel = $\varepsilon\{risk\}$,
		axis lines = left,
        enlargelimits=true
    ]
\addplot+[mark=none, ultra thick, blue]
table[meta=eps]
{trab2/EHL-6-44/ObjFunc.dat};
\end{axis}
\end{tikzpicture}
\caption{Comportamento de $\varepsilon\{risk\}$.}
\label{fig:ehl6-44}
\end{figure}

\subsubsection*{Solução do Exercício 6.44 utilizando o método de Newton}
Os resultados para utilisando o método de Newton foram obtidos com o
\autoref{code:ehl644script1} 
\lstinputlisting[language=Matlab, caption={Script de execução},
label={code:ehl644script1}]{trab2/EHL-6-44/Script1.m} 

Os resultados para cada interação:
\VerbatimInput[firstline=2, lastline=8]{trab2/EHL-6-44/Resultado1.txt}

Ponto de mínimo encontrado e função avaliada no ponto ótimo:
\begin{equation}
\renewcommand{\arraystretch}{1.2}
x^* = \left[
\begin{array}{c}
2.1873
\end{array}
\right]
\quad \text{e}\quad
\varepsilon\{risk\}(x^*)=-2.3888\times 10^8
\end{equation}
\VerbatimInput[firstline=16, lastline=23]{trab2/EHL-6-44/Resultado1.txt}
\clearpage

\emph{Output} final do Matlab, confirmando que foi utilizado o método de Newton
\VerbatimInput[firstline=31,
lastline=38]{trab2/EHL-6-44/Resultado1.txt}

Valores de $\nabla \varepsilon\{risk\}$ (\code{grad}), $\nabla^2
\varepsilon\{risk\}$ (\code{hessian}) e\\ $\lambda(\nabla^2
\varepsilon\{risk\})$ (\code{eigHessian}) , confirmando que se trata de um ponto de mínimo.
\VerbatimInput[firstline=41, lastline=53]{trab2/EHL-6-44/Resultado1.txt}
% \VerbatimInput[numbers=left]{trab2/EHL-6-44/Resultado1.txt}

\clearpage
\subsubsection*{Solução do Exercício 6.44 utilizando um método quasi-Newton}
Os resultados para o método de Newton foram obtidos com o 
\autoref{code:ehl644script2} \lstinputlisting[language=Matlab, caption={Script de execução}, 
label={code:ehl644script2}]{trab2/EHL-6-44/Script2.m} 

Os resultados para cada interação:
\VerbatimInput[firstline=5, lastline=12]{trab2/EHL-6-44/Resultado2.txt}

Ponto de mínimo encontrado e função avaliada no ponto ótimo:
\begin{equation}
\renewcommand{\arraystretch}{1.2}
x^* = \left[
\begin{array}{c}
2.1873
\end{array}
\right]
\quad \text{e}\quad
\varepsilon\{risk\}(x^*)=-2.3888\times 10^8
\end{equation}
\VerbatimInput[firstline=22, lastline=29]{trab2/EHL-6-44/Resultado2.txt}
\clearpage

\emph{Output} final do Matlab, confirmando que foi utilizado um método
quasi-Newton
\VerbatimInput[firstline=37,
lastline=44]{trab2/EHL-6-44/Resultado2.txt}\bigbreak

Valores de $\nabla \varepsilon\{risk\}$ (\code{grad}), $\nabla^2
\varepsilon\{risk\}$ (\code{hessian}) e\\ $\lambda(\nabla^2
\varepsilon\{risk\})$ (\code{eigHessian}) , confirmando que se trata de um
ponto de mínimo.
\VerbatimInput[firstline=47, lastline=59]{trab2/EHL-6-44/Resultado2.txt}
% \VerbatimInput[numbers=left]{trab2/EHL-6-44/Resultado2.txt} 



% \clearpage
% 
% \subsection{Exercício Antoine - Etanol}
% \boxexercise{Antoine - Etanol}{
% alguma coisa aqui\ldots
% }
% 
% Partindo de\ldots
% 
