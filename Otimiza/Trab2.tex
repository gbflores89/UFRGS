\newenvironment{conditions}[1][]
  {#1 \begin{tabular}[t]{>{$}r<{$} @{${}={}$} l @{$\quad$}r @{  }l}}
  {\end{tabular}\\[\belowdisplayskip]}

\section {Otimização sem restrições}

\subsection{Exercício 6.48 \cite{edgar2001optimization} (página 220)}
  
The cost of refined oil when shipped via the Malacca Straits to Japan in dollars
per kiloliter was given (Uchiyama, 1968) as the linear sum of the crude oil
cost, the insurance, customs, freight cost for the oil, loading and unloading
cost, sea berth cost, submarine pipe cost, storage cost, tank area cost,
refining cost, and freight cost of products as:
\begin{equation}
\label{eq:ehl648}
\begin{aligned}
c = c_c &+ c_i + c_x + \frac{2.09\times 10^{4} t^{-0.3017}}{360} + \frac{1.064
\times 10^{6} at^{0.4925}}{52.47q\left(360\right)} \\
&+ \frac{4.242 \times 10^{4} at^{0.7952} + 1.813 ip \left(nt + 1.2q
\right)^{0.861}}{52.47q\left(360\right)}\\
&+ \frac{4.25 \times 10^{3} a\left(nt+1.2q\right) }{52.47q\left(360\right)}
+ \frac{5.042 \times 10^{3} q^{-0.1899}}{360}\\
&+ \frac{0.1049q^{0.671}}{360}
\end{aligned}
\end{equation}
were: 
\begin{conditions}
a	& annual fixed charges	& {fraction}	&($0.20$) \\
c_c	& crude oil price		&{\$/kL}		&($12.50$)\\
c_i	& insurance cost		&{\$/kL}		&($0.50$)\\
c_x	& customs cost			&{\$/kL}		&($0.90$)\\
i	& interest rate			&				&($0.10$)\\
n	& number of ports		&				&($2$)\\ 
p	& land price			&{\$/m$^2$}		&($7000$)\\
q	& refinery capacity		&{bbl/day}		&\\
t	& tanker size			&{kL} 			&\\
\end{conditions}
Given the values indicated in parentheses, use a computer code to compute the
minimum cost of oil and the optimum tanker size $t$ and refinery size $q$ by
Newton's method and the quasi-Newton method (note that $1~\text{kL} = 6.29
~\text{bbl}$).

The answers in the reference were:
\begin{conditions}
t & $427000$ dwt $\approx$ $485000$ kL \\
q & $185000$ bbl/day
\end{conditions}


\noindent\makebox[\linewidth]{\rule{\textwidth}{0.4pt}}

Substituindo os valores de $a$, $c_c$, $c_i$, $c_x$, $i$, $n$ e $p$ na
\autoref{eq:ehl648} temos:
\begin{equation}
\begin{aligned}
c = 13.9 & + \cfrac{58.055}{{t}^{0.3017}}
+{\cfrac {11.266{t}^{ 0.4925}}{q}}\\
&+{\cfrac {5.294\times10^{-5}\left( 8484{t}^{
0.7952}
+1268.4\left( 2t+ 1.2q \right) ^{ 0.861}\right)}{q}}\\
&+\cfrac{0.630}{{q}^{1.1899}}
+2.914\times10^{-4}{q}^{ 0.671}
\end{aligned}
\end{equation}
onde o gradiente e hessiana de $c$ são dados por:
\begin{equation}
\renewcommand{\arraystretch}{2.5}
\nabla c = \left[
\begin{array}{c}
\cfrac{\partial c}{\partial t}\\
\cfrac{\partial c}{\partial q}\\
\end{array}
\right]
\quad \text{e}\quad
\nabla^2 c = \left[
\begin{array}{cc}
\cfrac{\partial^2 c}{\partial t^2}
& \cfrac{\partial^2 c}{\partial t \partial q}\\
\cfrac{\partial^2 c}{\partial q \partial t}
& \cfrac{\partial^2 c}{\partial q^2}
\end{array}
\right]
\end{equation}

As equações necessárias para $\nabla c$ e $\nabla^2c$ são dadas por:
\allowdisplaybreaks
\begin{align}
&\begin{aligned}
\cfrac{\partial c}{\partial t}= &- \cfrac{17.515}{{t}^{1.3017}}
+ {\cfrac {5.548}{t^{0.5075}q}}\\
&+ {\cfrac {5.294\times10^{-5} \left(\cfrac{6746.476}{{t}^{0.2048}}
+ \cfrac{2184.185}{\left( 2t+ 1.2q \right) ^{0.139}} \right)}{q}}
\end{aligned}\\
&\begin{aligned}
\cfrac{\partial c}{\partial q}=
& - {\cfrac {11.266{t}^{ 0.4925}}{{q}^{2}}}+ {\cfrac {0.0694 }{\left(
 2t+ 1.2q \right) ^{0.139}q}}\\
&- {\cfrac {5.294\times10^{-5} \left(8484.0{t}^{ 0.7952}
+ 1268.4 \left( 2\,t+ 1.2\,q \right) ^{ 0.861}\right)}{{q}^{2}}}\\
&-\cfrac{0.750}{{q}^{2.1899}} + \cfrac{1.955\times10^{-4}}{{q}^{0.329}}
\end{aligned}\\
&\begin{aligned}
\cfrac{\partial^2 c}{\partial t^2}=& \cfrac{22.800}{{t}^{2.3017}} -
{\cfrac {2.816}{{t}^{1.5075}q}}\\
&+  \cfrac {5.294\times10^{-5} \left( -\cfrac{1381.678}{{t}^{1.2048}}
- \cfrac{607.203}{ \left( 2\,t+ 1.2\,q \right) ^{1.139}}\right) }{q}
\end{aligned}\\
&\begin{aligned}
\cfrac{\partial^2 c}{\partial t \partial q}=& \cfrac{\partial^2 c}{\partial q
\partial t}= {\cfrac {5.548}{{t}^{0.5075}{q}^{2}}} - {\cfrac {0.01929 }{\left(2t+ 1.2q\right)
^{1.139}q}} \\
&- {\cfrac {5.294\times10^{-5} \left(\cfrac{6746.476}{{t}^{0.2048}}
+ \cfrac{2184.184}{\left( 2t+ 1.2q \right) ^{0.139}} \right)}{{q}^{2}}}
\end{aligned}\\
&\begin{aligned}
\cfrac{\partial^2 c}{\partial q^2}=
& {\cfrac {22.531{t}^{ 0.4925}}{{q}^{3}}} - {\cfrac {0.01157}{\left(
2t+ 1.2q \right) ^{1.139}q}} - {\cfrac {0.1387 }{\left( 2t+ 1.2q
\right) ^{0.139}{q}^{2}}}\\
&+ \cfrac {{1.059\times10^{-4}} \left(8484.0{t}^{ 0.7952} +
1268.4\left(2t+1.2q\right)^{0.861} \right)}{{q}^{3}} \\
&+ \cfrac{1.642}{{q}^{3.1899}} -
\cfrac{6.433\times10^{-5}}{{q}^{1.329}}
\end{aligned}
\end{align} 
 
Para a execução dos problemas, os Códigos \ref{code:c1},
\ref{code:c2} e \ref{code:c3} foram implemantados em Matlab da
seguinte maneira:
\lstinputlisting[caption={Problema proposto},
label={code:c1}]{trab2/EHL-6-48/ObjFunc.m} 

\lstinputlisting[caption={Gradiente do problema proposto},
label={code:c2}]{trab2/EHL-6-48/ObjFuncGrad.m} 

\lstinputlisting[caption={Hessiana do problema proposto},
label={code:c3}]{trab2/EHL-6-48/ObjFuncHessian.m} 
sendo que:
\begin{conditions}
x(1) & $t$\\
x(2) & $q$
\end{conditions}

\subsubsection{Newton}
Os resultados para o método de Newton foram obtidos com o \autoref{code:script1}
\lstinputlisting[language=Matlab, caption={Script de execução},
label={code:script1}]{trab2/EHL-6-48/Script1.m}

Os resultados para cada interação:
\VerbatimInput[firstline=0, lastline=18]{trab2/EHL-6-48/Resultado1.txt}

\clearpage
Ponto de mínimo encontrado e função avaliada no ponto ótimo:
\begin{equation}
\renewcommand{\arraystretch}{1.2}
x^* = \left[
\begin{array}{c}
502050\\
80850\\ 
\end{array}
\right]
\quad \text{e}\quad
c(x^*)=15.9900
\end{equation}
\VerbatimInput[firstline=22, lastline=31]{trab2/EHL-6-48/Resultado1.txt}

\emph{Output} final do Matlab, confirmando que foi utilizado o método de Newton
\VerbatimInput[firstline=39,
lastline=46]{trab2/EHL-6-48/Resultado1.txt}\bigbreak


Valores de $\nabla c$ (\code{grad}), $\nabla^2 c$ (\code{hessian}) e
$\lambda(\nabla^2 c)$ (\code{eigHessian}) , confirmando que se trata de um
ponto de mínimo.
\VerbatimInput[firstline=49, lastline=62]{trab2/EHL-6-48/Resultado1.txt}

\clearpage
\subsubsection{quasi-Newton}
Os resultados para o método de Newton foram obtidos com o \autoref{code:script2}
\lstinputlisting[language=Matlab, caption={Script de execução}, 
label={code:script2}]{trab2/EHL-6-48/Script2.m}

Os resultados para cada interação:
\VerbatimInput[firstline=0, lastline=4]{trab2/EHL-6-48/Resultado2.txt}

Ponto de mínimo encontrado e função avaliada no ponto ótimo:
\begin{equation}
\renewcommand{\arraystretch}{1.2}
x^* = \left[
\begin{array}{c}
500350\\
89660\\ 
\end{array}
\right]
\quad \text{e}\quad
c(x^*)=15.9921
\end{equation}
\VerbatimInput[firstline=8, lastline=17]{trab2/EHL-6-48/Resultado2.txt}

\emph{Output} final do Matlab, confirmando que foi utilizado um método
quasi-Newton
\VerbatimInput[firstline=25,
lastline=32]{trab2/EHL-6-48/Resultado2.txt}\bigbreak


Valores de $\nabla c$ (\code{grad}), $\nabla^2 c$ (\code{hessian}) e
$\lambda(\nabla^2 c)$ (\code{eigHessian}) , confirmando que se trata de um
ponto de mínimo.
\VerbatimInput[firstline=35, lastline=48]{trab2/EHL-6-48/Resultado2.txt}
% \VerbatimInput[numbers=left]{trab2/EHL-6-48/Resultado2.txt}

\subsubsection{Conlusão do exercício 6.48}
Para o problema proposto, o método quasi-Newton apresentou melhor resultado, uma
vez que foi necessário um menor número de passos para chegar em $x^*$.

\clearpage
\subsection{Exercício 6.44 \cite{edgar2001optimization} (página 219)}
In a decision problem it is desired to minimize the expected risk defined as
follows: 
\begin{equation}
\varepsilon \{\text{risk} \} = \left(1-P\right)c_1\left[1-F(b) \right] + P c_2
\theta
\left(\frac{b}{2}+\frac{2\pi}{4}\right)F\left(\frac{b}{2}-\frac{\sqrt{2\pi}}{4}\right)
\end{equation}
were: 
\begin{conditions}
F(b) & $\displaystyle\int_{-\infty}^b e^{-u^2 / 2\theta^2} \text{d}u$ (normal
probability function)\\
c_1 & $1.25\times10^{5}$\\
c_2& $15$\\
\theta & $2000$\\
P &$0.25$
\end{conditions}
Find the minimum expected risk and $b$.  

\noindent\makebox[\linewidth]{\rule{\textwidth}{0.4pt}}

bla


\clearpage
\subsection{Exercício Antoine - Etanol}
bla

